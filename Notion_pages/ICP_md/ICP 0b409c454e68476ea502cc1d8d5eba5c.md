# ICP

> ***ì˜¤ëŠ˜ì˜ ë°œí‘œ***

- ICP ì´ë¡  : Swimming ğŸŠâ€â™€ï¸
- ì½”ë“œ êµ¬í˜„ : StrongPine ğŸŒ²

## ICPê°€ í’€ê³ ì í•˜ëŠ” ê²ƒ

1. **R**otation and **t**ranslation matrix
2. **C**orrespondence

![ICP%200b409c454e68476ea502cc1d8d5eba5c/Untitled.png](ICP%200b409c454e68476ea502cc1d8d5eba5c/Untitled.png)

> **Assumption**: ê°€ì¥ ê°€ê¹Œìš´ ì§€ì ì´ correspondenceì¼ ê²ƒì´ë‹¤.

![ICP%200b409c454e68476ea502cc1d8d5eba5c/Untitled%201.png](ICP%200b409c454e68476ea502cc1d8d5eba5c/Untitled%201.png)

![ICP%200b409c454e68476ea502cc1d8d5eba5c/Untitled%202.png](ICP%200b409c454e68476ea502cc1d8d5eba5c/Untitled%202.png)

*Slides from..* 

![ICP%200b409c454e68476ea502cc1d8d5eba5c/Untitled%203.png](ICP%200b409c454e68476ea502cc1d8d5eba5c/Untitled%203.png)

---

### Least-Squares Fitting of Two 3-D Point Sets

- ìš°ë¦¬ê°€ í’€ê³ ì í•˜ëŠ” ë¬¸ì œëŠ” ì´ëŸ¬í•œ ìƒí™©ì—ì„œ `Least Square`ë¥¼ í†µí•´ `sigma`ë¥¼ ìµœì†Œí™”ì‹œí‚¤ëŠ” R,të¥¼ ì°¾ëŠ” ê²ƒ ì…ë‹ˆë‹¤.

![ICP%200b409c454e68476ea502cc1d8d5eba5c/Untitled%204.png](ICP%200b409c454e68476ea502cc1d8d5eba5c/Untitled%204.png)

![ICP%200b409c454e68476ea502cc1d8d5eba5c/Untitled%205.png](ICP%200b409c454e68476ea502cc1d8d5eba5c/Untitled%205.png)

- ìŒ... 3ê°œ í•­ì´ ìˆëŠ”ë°ìš” í•­ í•˜ë‚˜ë¥¼ ì œê±°í•  ìˆ˜ëŠ” ì—†ì„ê¹Œìš”??

> Translation termì„ ì œê±°í•˜ê¸° ìœ„í•´ **centroid** ê°œë…ì„ ë„ì…

![ICP%200b409c454e68476ea502cc1d8d5eba5c/Untitled%206.png](ICP%200b409c454e68476ea502cc1d8d5eba5c/Untitled%206.png)

![ICP%200b409c454e68476ea502cc1d8d5eba5c/Untitled%207.png](ICP%200b409c454e68476ea502cc1d8d5eba5c/Untitled%207.png)

![ICP%200b409c454e68476ea502cc1d8d5eba5c/Untitled%208.png](ICP%200b409c454e68476ea502cc1d8d5eba5c/Untitled%208.png)

ì¤‘ì‹¬ì„ ê¸°ì¤€ìœ¼ë¡œëŠ” ê°™ì€ ì°¨ì´!!

ì¢‹ìŠµë‹ˆë‹¤ ğŸ˜‰ ê·¸ëŸ¼ ì´ì œ ì´ ì‹ì„ ì „ê°œí•´ë´…ë‹ˆë‹¤.

- sigmaë¥¼ ìµœì†Œí™” í•˜ê¸° ìœ„í•´ì„œëŠ” ë§ˆì§€ë§‰ ì°¨ë¶„ í•­ì´ ìµœëŒ€ê°€ ë˜ì–´ì•¼ê² ë„¤ìš”!! ì´ë¥¼ ìœ„í•œ Rê°’ì„ êµ¬í•´ë´…ì‹œë‹¤.

![ICP%200b409c454e68476ea502cc1d8d5eba5c/Untitled%209.png](ICP%200b409c454e68476ea502cc1d8d5eba5c/Untitled%209.png)

- ì–´ë–¤ Rì´ ì´ ê°’ì„ ìµœëŒ€ë¡œ ë§Œë“¤ê¹Œìš”??

---

### ğŸ‘¦ ìš°ë¦¬ ë‚˜ë¦„ëŒ€ë¡œì˜ í•´ì„!

Rì€ ì–´ë–¤ í–‰ë ¬ì¼ê¹Œìš”?

1. í–‰ë ¬ê³±ì€ ê¸°í•˜í•™ì ìœ¼ë¡œ **ë‚´ì **ì˜ ì˜ë¯¸ë¥¼ ê°€ì§‘ë‹ˆë‹¤.
2. ë‚´ì ì„ ìµœëŒ€ë¡œ ë§Œë“œëŠ” theta ê°’ì€??

![ICP%200b409c454e68476ea502cc1d8d5eba5c/Untitled%2010.png](ICP%200b409c454e68476ea502cc1d8d5eba5c/Untitled%2010.png)

![ICP%200b409c454e68476ea502cc1d8d5eba5c/Untitled%2011.png](ICP%200b409c454e68476ea502cc1d8d5eba5c/Untitled%2011.png)

ìš°ë¦¬ê°€ ì°¾ê³ ì í•˜ëŠ” Rì€ ë‘ point cloudë“¤ ì‚¬ì´ì˜ `Rotation Matrix`ê°€ ì…ë‹ˆë‹¤.

### ê·¸ëŸ¼ ì´ê±¸ ì–´ë–»ê²Œ ì°¾ì£  â“â“

- Least Square Problem
- SVD & Pseudo inverse

![ICP%200b409c454e68476ea502cc1d8d5eba5c/Untitled%2012.png](ICP%200b409c454e68476ea502cc1d8d5eba5c/Untitled%2012.png)

![ICP%200b409c454e68476ea502cc1d8d5eba5c/Untitled%2013.png](ICP%200b409c454e68476ea502cc1d8d5eba5c/Untitled%2013.png)

- ìš°ë¦¬ì˜ ê²½ìš°

![ICP%200b409c454e68476ea502cc1d8d5eba5c/Untitled%2014.png](ICP%200b409c454e68476ea502cc1d8d5eba5c/Untitled%2014.png)

*image from : [http://blog.naver.com/infoefficien/220790846543](http://blog.naver.com/infoefficien/220790846543)*

> H inverseê°€ ì—†ìœ¼ë©´...? â‡’ `SVD` â‡’ `Pseudo Inverse`

![ICP%200b409c454e68476ea502cc1d8d5eba5c/Untitled%2015.png](ICP%200b409c454e68476ea502cc1d8d5eba5c/Untitled%2015.png)

*image from : [https://angeloyeo.github.io/2019/08/01/SVD.html](https://angeloyeo.github.io/2019/08/01/SVD.html)*

- Rì€ íšŒì „ í–‰ë ¬ì´ê¸° ë•Œë¬¸ì— **Î£ = I**

![ICP%200b409c454e68476ea502cc1d8d5eba5c/Untitled%2016.png](ICP%200b409c454e68476ea502cc1d8d5eba5c/Untitled%2016.png)

**Exception** : **determinant**ê°€ -1ì¸ ê²½ìš° (í¬ê¸°ëŠ” ê°™ì§€ë§Œ, ë°©í–¥ì´ ë°˜ëŒ€)

![ICP%200b409c454e68476ea502cc1d8d5eba5c/Untitled%2017.png](ICP%200b409c454e68476ea502cc1d8d5eba5c/Untitled%2017.png)

### translationì€ìš” â“â“

`centroid`ì˜ ì°¨ì´ë¡œ ê³„ì‚°!!

[ClayFlannigan/icp](https://github.com/ClayFlannigan/icp/blob/master/icp.py)

```python
def best_fit_transform(A, B):
    '''
    Calculates the least-squares best-fit transform that maps corresponding points A to B in m spatial dimensions
    Input:
      A: Nxm numpy array of corresponding points
      B: Nxm numpy array of corresponding points
    Returns:
      T: (m+1)x(m+1) homogeneous transformation matrix that maps A on to B
      R: mxm rotation matrix
      t: mx1 translation vector
    '''

    assert A.shape == B.shape

    # get number of dimensions
    m = A.shape[1]

    # translate points to their centroids
    centroid_A = np.mean(A, axis=0)
    centroid_B = np.mean(B, axis=0)
    AA = A - centroid_A
    BB = B - centroid_B

    # rotation matrix
    H = np.dot(AA.T, BB)
    U, S, Vt = np.linalg.svd(H)
    R = np.dot(Vt.T, U.T)

    # special reflection case
    if np.linalg.det(R) < 0:
       Vt[m-1,:] *= -1
       R = np.dot(Vt.T, U.T)

    # translation
    t = centroid_B.T - np.dot(R,centroid_A.T)

    # homogeneous transformation
    T = np.identity(m+1)
    T[:m, :m] = R
    T[:m, m] = t

**    return T, R, t
```

### **C**orrespondenceëŠ”ìš” â“â“

- In real Lidar SLAM...

![ICP%200b409c454e68476ea502cc1d8d5eba5c/Untitled%2018.png](ICP%200b409c454e68476ea502cc1d8d5eba5c/Untitled%2018.png)

![ICP%200b409c454e68476ea502cc1d8d5eba5c/Untitled%2019.png](ICP%200b409c454e68476ea502cc1d8d5eba5c/Untitled%2019.png)

slides from : [http://www2.informatik.uni-freiburg.de/~stachnis/pdf/rbpf-slam-tutorial-2007.pdf](http://www2.informatik.uni-freiburg.de/~stachnis/pdf/rbpf-slam-tutorial-2007.pdf)

***homogeneous transformation*** ì´ë€?

![ICP%200b409c454e68476ea502cc1d8d5eba5c/Untitled%2020.png](ICP%200b409c454e68476ea502cc1d8d5eba5c/Untitled%2020.png)

**T**ranslationê³¼ **R**otationì„ 

1. í•˜ë‚˜ì˜ í–‰ë ¬ë¡œ 
2. Linear ì—°ì‚°ìœ¼ë¡œ í‘œí˜„í•˜ê¸° ìœ„í•´

***Homogeneous transformation***ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.

### Paper

---

[icp.pdf](ICP%200b409c454e68476ea502cc1d8d5eba5c/icp.pdf)

- ê·¸ëŸ¼... ë“œë””ì–´....

    ## í•œì†”ë‹˜ê³¼ í•¨ê»˜í•˜ëŠ” ì¦ê±°ìš´ ì½”ë”© ì‹œê°„ğŸ„â€â™‚ï¸

    ![ICP%200b409c454e68476ea502cc1d8d5eba5c/Untitled%2021.png](ICP%200b409c454e68476ea502cc1d8d5eba5c/Untitled%2021.png)

    ![ICP%200b409c454e68476ea502cc1d8d5eba5c/Untitled%2022.png](ICP%200b409c454e68476ea502cc1d8d5eba5c/Untitled%2022.png)

    ![ICP%200b409c454e68476ea502cc1d8d5eba5c/Untitled%2023.png](ICP%200b409c454e68476ea502cc1d8d5eba5c/Untitled%2023.png)